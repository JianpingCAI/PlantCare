<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="PlantCare.App.Views.SingePlantCareHistoryView"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:components="clr-namespace:PlantCare.App.Components"
    xmlns:utils="clr-namespace:PlantCare.App.Utils"
    xmlns:vm="clr-namespace:PlantCare.App.ViewModels"
    x:Name="thisPage"
    x:DataType="vm:SinglePlantCareHistoryViewModel">

    <Shell.TitleView>
        <Grid
            Padding="12,0,8,0"
            ColumnDefinitions="auto,*"
            ColumnSpacing="12">
            <!--  Icon  -->
            <Border
                HorizontalOptions="Start"
                Stroke="Transparent"
                StrokeThickness="0"
                VerticalOptions="Center">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow
                        Brush="{StaticResource Primary}"
                        Opacity="0.15"
                        Radius="8"
                        Offset="0,2" />
                </Border.Shadow>
                <Image
                    HeightRequest="44"
                    Source="default_plant.png"
                    WidthRequest="44" />
            </Border>

            <!--  Title Section  -->
            <VerticalStackLayout
                Grid.Column="1"
                Spacing="2"
                VerticalOptions="Center">
                <Label
                    Style="{StaticResource TitleSmallStyle}"
                    Text="{Binding PlantName}"
                    VerticalTextAlignment="Center" />
                <Label
                    Opacity="0.7"
                    Style="{StaticResource CaptionStyle}"
                    Text="{Binding Path=[CareHistory], Source={x:Static utils:LocalizationManager.Instance}}"
                    VerticalTextAlignment="Center" />
            </VerticalStackLayout>
        </Grid>
    </Shell.TitleView>

    <Grid Padding="5,2,5,0" x:DataType="vm:SinglePlantCareHistoryViewModel">
        <Grid>
            <CollectionView ItemsSource="{Binding TimestampRecords}">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical" Span="1" />
                </CollectionView.ItemsLayout>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="vm:TimeStampRecord">
                        <Border
                            Padding="3"
                            StrokeThickness="1"
                            VerticalOptions="Center">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="5" />
                            </Border.StrokeShape>
                            <Grid ColumnDefinitions="*,auto">
                                <Label
                                    FontAttributes="Bold"
                                    HorizontalOptions="Start"
                                    Style="{StaticResource HeadlineSmallStyle}"
                                    Text="{Binding Timestamp, StringFormat='{0:MM/dd/yyyy HH:mm}'}" />
                                <Button
                                    Grid.Column="1"
                                    Margin="10,0,5,0"
                                    Command="{Binding Source={x:Reference thisPage}, Path=BindingContext.DeleteRecordCommand}"
                                    CommandParameter="{Binding .}"
                                    Style="{StaticResource FabButtonStyle}"
                                    VerticalOptions="Center">
                                    <Button.ImageSource>
                                        <FontImageSource
                                            FontFamily="MaterialIconsRegular"
                                            Glyph="&#xe92b;"
                                            Size="24"
                                            Color="White" />
                                    </Button.ImageSource>
                                </Button>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>

        <components:LoadingOverlayView IsVisible="{Binding IsLoading}" />
    </Grid>
</ContentPage>
