<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="PlantCare.App.Views.PlantAddEditView"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:dataAnnotations="clr-namespace:System.ComponentModel.DataAnnotations;assembly=System.ComponentModel.Annotations"
    xmlns:local="clr-namespace:PlantCare.App.Utils"
    xmlns:vm="clr-namespace:PlantCare.App.ViewModels"
    Title="{Binding Name, StringFormat='Edit: {0}'}"
    x:DataType="vm:PlantAddEditViewModel">
    <ContentPage.Resources>
        <ResourceDictionary>
            <local:StringToIntConverter x:Key="StringToIntConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>
    <Grid>
        <ScrollView>
            <Grid>
                <VerticalStackLayout Padding="10">
                    <Border
                        HorizontalOptions="Center"
                        Stroke="Transparent"
                        StrokeThickness="0"
                        VerticalOptions="Center">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="50" />
                        </Border.StrokeShape>
                        <Image
                            Aspect="AspectFit"
                            HorizontalOptions="Center"
                            MaximumWidthRequest="{OnIdiom Phone=300,
                                                          Default=500}"
                            Source="{Binding PhotoPath}"
                            VerticalOptions="Center" />
                    </Border>

                    <Grid ColumnDefinitions="*,*">
                        <Button
                            Margin="5,5"
                            Command="{Binding UploadImageCommand}"
                            FontFamily="MaterialIconsRegular"
                            FontSize="30"
                            HorizontalOptions="Center"
                            Text="&#xe413;"
                            VerticalOptions="Center" />
                        <Button
                            Grid.Column="1"
                            Margin="5,5"
                            Command="{Binding TakePhotoCommand}"
                            FontFamily="MaterialIconsRegular"
                            FontSize="30"
                            HorizontalOptions="Center"
                            Text="&#xe439;"
                            VerticalOptions="Center" />
                    </Grid>

                    <Border Padding="5">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="5" />
                        </Border.StrokeShape>
                        <Grid
                            ColumnDefinitions="*,*"
                            HorizontalOptions="Start"
                            RowDefinitions="*,*,*">

                            <Label Text="Name" />
                            <Entry
                                Grid.Column="1"
                                Margin="5,0,0,0"
                                Text="{Binding Name, Mode=TwoWay}"
                                VerticalOptions="End" />

                            <Label Grid.Row="1" Text="Species" />
                            <Entry
                                Grid.Row="1"
                                Grid.Column="1"
                                Margin="5,0,0,0"
                                Text="{Binding Species, Mode=TwoWay}"
                                VerticalOptions="Start" />

                            <Label
                                Grid.Row="2"
                                FontAttributes="Bold"
                                Text="Age" />
                            <HorizontalStackLayout Grid.Row="2" Grid.Column="1">
                                <Entry
                                    Margin="5,0,0,0"
                                    HorizontalTextAlignment="Center"
                                    Text="{Binding Age, Mode=TwoWay, Converter={StaticResource StringToIntConverter}}"
                                    VerticalOptions="End" />
                                <Stepper
                                    Increment="1"
                                    Maximum="3000"
                                    MaximumWidthRequest="{OnIdiom Phone=120,
                                                                  Default=200}"
                                    Minimum="0"
                                    Value="{Binding Age, Mode=TwoWay}" />
                            </HorizontalStackLayout>
                        </Grid>
                    </Border>

                    <!--  Watering  -->
                    <Border Margin="0,5" Padding="5">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="5" />
                        </Border.StrokeShape>
                        <Grid
                            ColumnDefinitions="90,*"
                            HorizontalOptions="Start"
                            RowDefinitions="*,*">
                            <Label FontAttributes="Bold" Text="Last Watering" />

                            <HorizontalStackLayout Grid.Column="1" Margin="5,0,0,0">
                                <DatePicker Date="{Binding LastWateredDate, Mode=TwoWay}" VerticalOptions="End" />
                                <TimePicker Time="{Binding LastWateredTime, Mode=TwoWay}" VerticalOptions="End" />
                                <Button
                                    Margin="10,0,0,0"
                                    Command="{Binding SetCurrentTimeAsLastWateredCommand}"
                                    Text="Now"
                                    VerticalOptions="Center" />
                            </HorizontalStackLayout>

                            <Label
                                Grid.Row="1"
                                FontAttributes="Bold"
                                Text="Waterting &#10;Interval" />

                            <VerticalStackLayout
                                Grid.Row="1"
                                Grid.Column="1"
                                Margin="5,0,0,0">
                                <HorizontalStackLayout>
                                    <Entry
                                        HorizontalTextAlignment="Center"
                                        Text="{Binding WateringFrequencyDays, Mode=TwoWay, Converter={StaticResource StringToIntConverter}}"
                                        VerticalOptions="Center" />
                                    <Stepper
                                        Increment="1"
                                        Maximum="365"
                                        MaximumWidthRequest="{OnIdiom Phone=120,
                                                                      Default=200}"
                                        Minimum="0"
                                        Value="{Binding WateringFrequencyDays, Mode=TwoWay}" />
                                    <Label Margin="5,0,10,0" Text="Days" />
                                </HorizontalStackLayout>

                                <HorizontalStackLayout>
                                    <Entry
                                        HorizontalTextAlignment="Center"
                                        Text="{Binding WateringFrequencyHours, Mode=TwoWay, Converter={StaticResource StringToIntConverter}}"
                                        VerticalOptions="Center" />
                                    <Stepper
                                        Increment="1"
                                        Maximum="23"
                                        MaximumWidthRequest="{OnIdiom Phone=120,
                                                                      Default=200}"
                                        Minimum="0"
                                        Value="{Binding WateringFrequencyHours, Mode=TwoWay}" />
                                    <Label Margin="5,0,0,0" Text="Hours" />
                                </HorizontalStackLayout>
                            </VerticalStackLayout>
                        </Grid>
                    </Border>

                    <!--  Fertilization  -->
                    <Border Padding="5">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="5" />
                        </Border.StrokeShape>
                        <Grid
                            ColumnDefinitions="90,*"
                            HorizontalOptions="Start"
                            RowDefinitions="*,*">
                            <Label FontAttributes="Bold" Text="Last  &#10;Fertilization" />

                            <HorizontalStackLayout Grid.Column="1" Margin="5,0,0,0">
                                <DatePicker Date="{Binding LastFertilizationDate, Mode=TwoWay}" VerticalOptions="End" />
                                <TimePicker Time="{Binding LastFertilizationTime, Mode=TwoWay}" VerticalOptions="End" />
                                <Button
                                    Margin="10,0,0,0"
                                    Command="{Binding SetCurrentTimeAsLastFertilizationCommand}"
                                    Text="Now"
                                    VerticalOptions="Center" />
                            </HorizontalStackLayout>

                            <Label
                                Grid.Row="1"
                                FontAttributes="Bold"
                                Text="Fertilization &#10;Interval" />

                            <VerticalStackLayout
                                Grid.Row="1"
                                Grid.Column="1"
                                Margin="5,0,0,0">
                                <HorizontalStackLayout>
                                    <Entry
                                        HorizontalTextAlignment="Center"
                                        Text="{Binding FertilizationFrequencyDays, Mode=TwoWay, Converter={StaticResource StringToIntConverter}}"
                                        VerticalOptions="Center" />
                                    <Stepper
                                        Increment="1"
                                        Maximum="365"
                                        MaximumWidthRequest="{OnIdiom Phone=120,
                                                                      Default=200}"
                                        Minimum="0"
                                        Value="{Binding FertilizationFrequencyDays, Mode=TwoWay}" />
                                    <Label Margin="5,0,10,0" Text="Days" />
                                </HorizontalStackLayout>

                                <HorizontalStackLayout>
                                    <Entry
                                        HorizontalTextAlignment="Center"
                                        Text="{Binding FertilizationFrequencyHours, Mode=TwoWay, Converter={StaticResource StringToIntConverter}}"
                                        VerticalOptions="Center" />
                                    <Stepper
                                        Increment="1"
                                        Maximum="23"
                                        MaximumWidthRequest="{OnIdiom Phone=120,
                                                                      Default=200}"
                                        Minimum="0"
                                        Value="{Binding FertilizationFrequencyHours, Mode=TwoWay}" />
                                    <Label Margin="5,0,0,0" Text="Hours" />
                                </HorizontalStackLayout>
                            </VerticalStackLayout>
                        </Grid>
                    </Border>

                    <VerticalStackLayout Margin="0,10,0,0" BindableLayout.ItemsSource="{Binding Errors}">
                        <BindableLayout.ItemTemplate>
                            <DataTemplate x:DataType="dataAnnotations:ValidationResult">
                                <!--<Label Style="{StaticResource ErrorLabelStyle}" Text="{Binding ErrorMessage}" />-->
                                <Label Text="{Binding ErrorMessage}" />
                            </DataTemplate>
                        </BindableLayout.ItemTemplate>
                    </VerticalStackLayout>

                    <Button
                        Margin="0,10,0,0"
                        Command="{Binding SubmitCommand}"
                        HorizontalOptions="CenterAndExpand"
                        MinimumWidthRequest="150"
                        Text="Save" />
                </VerticalStackLayout>
            </Grid>
        </ScrollView>
        <!--<Grid BackgroundColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray500}}" IsVisible="{Binding IsLoading}">
            <ActivityIndicator IsRunning="{Binding IsLoading}" />
        </Grid>-->
    </Grid>
</ContentPage>